<div class="p-4 lg:p-6 flex flex-col h-[calc(100vh-73px)]">
  <h2 class="text-lg font-medium text-gray-900 mb-4">Llaves</h2>

  @if (isLoading()) {
    <!-- Estado cargando -->
    <div class="flex items-center space-x-2 text-gray-600">
      <svg
        class="animate-spin h-5 w-5"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        ></path>
      </svg>
      <span>Cargando esquemas...</span>
      @if (loadingSource()) {
        <span class="text-sm text-blue-600">(Cloud V6)</span>
      }
      @if (loadingTarget()) {
        <span class="text-sm text-green-600">(Fluency V5)</span>
      }
    </div>
  } @else {
    @if (!sourceSchemaReady()) {
      <!-- âœ… Mensaje si no hay documento fuente -->
      <div class="flex-1 flex items-center justify-center">
        <span class="text-gray-500 text-lg">Seleccione un documento fuente primero</span>
      </div>
    } @else if (documentSchema() !== null && documentSchema()!.keywords.length === 0) {
      <!-- âœ… Mensaje si no hay llaves -->
      <div class="flex-1 flex items-center justify-center">
        <span class="text-gray-500 text-lg">Documento sin llaves asignadas</span>
      </div>
    } @else {
      <!-- Indicador del estado de comparaciÃ³n -->
      @if (!bothSchemasReady()) {
        <div class="mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg">
          <div class="flex items-start">
            <div class="w-5 h-5 text-amber-500 mr-3 mt-0.5">âš </div>
            <div class="text-sm text-amber-800">
              <strong>Sin documento destino seleccionado</strong> - Mostrando solo llaves del
              documento fuente
            </div>
          </div>
        </div>
      }

      <!-- âœ… Lista con scroll sutil -->
      <div
        class="flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400 space-y-3 mb-6"
      >
        @if (documentSchema() !== null) {
          @for (item of documentSchema()!.keywords; track item.name) {
            <div
              class="flex items-start p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors"
            >
              <input
                type="checkbox"
                [checked]="item.isSync"
                [disabled]="item.isSync || fieldIsTypeImage(item)"
                class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1 mr-3 flex-shrink-0"
                [class.opacity-50]="!bothSchemasReady()"
                (change)="markKeyword($event, item)"
              />
              <div class="w-4 h-4 text-blue-600 mr-3 mt-0.5 flex-shrink-0">ðŸ”‘</div>
              <div class="flex-1 min-w-0">
                <div class="text-sm font-medium text-gray-900 mb-1 break-words">
                  {{ item.name }}
                </div>
                <div class="text-sm font-medium text-gray-900 mb-1 break-words">
                  ({{ item.label }})
                </div>
                <div class="flex items-center">
                  @if (item.require && !item.isSync) {
                    <app-iconography
                      iconType="warn"
                      tooltipText="Campo requerido en el documento fuente"
                    />
                  }
                  @if (item.isSync && bothSchemasReady()) {
                    <app-iconography
                      iconType="check"
                      tooltipText="Campo sincronizado con el documento destino"
                    />
                  }
                  @if (!bothSchemasReady()) {
                    <app-iconography
                      iconType="unasign"
                      tooltipText="Campo no asignado en el documento destino"
                    />
                  }
                  @if (item.presentInTarget) {
                    <app-iconography
                      iconType="sync"
                      tooltipText="Campo sincronizado en fuente y destino"
                    />
                  } @else {
                    <app-iconography
                      iconType="not-sync"
                      tooltipText="Campo no sincronizado en fuente y destino"
                    />
                  }
                </div>
              </div>
            </div>
          }
        }
      </div>
    }
  }
</div>
