<h2 class="font-semibold text-gray-700 mb-2">Llaves</h2>

@if(isLoading()) {
  <div class="flex items-center space-x-2 text-gray-600">
    <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    <span>Cargando esquemas...</span>
    @if(loadingSource()) {
      <span class="text-sm text-blue-600">(Cloud V6)</span>
    }
    @if(loadingTarget()) {
      <span class="text-sm text-green-600">(Fluency V5)</span>
    }
  </div>
}
@else {
  @if(!sourceSchemaReady()) {
    <div class="text-gray-500 text-sm">
      <p>Seleccione el tipo de documento fuente para ver las llaves disponibles.</p>
    </div>
  }
  @else {
    <!-- Indicador del estado de comparaci贸n -->
    @if(!bothSchemasReady()) {
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
        <div class="flex items-center space-x-2 text-yellow-800">
          <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
          </svg>
          <span class="text-sm font-medium">
            Sin documento destino seleccionado - Mostrando solo llaves del documento fuente
          </span>
        </div>
      </div>
    }

    <ul class="space-y-2">
      @if(documentSchema() !== null) {
        @if(documentSchema()!.keywords.length === 0) {
          <li class="text-gray-500 italic">Documento sin llaves asignadas</li>
        }
        @else {
          @for (item of documentSchema()!.keywords; track item.name) {
            <li>
              <label class="flex items-center space-x-2 text-gray-700 hover:text-gray-900 cursor-pointer">
                <input 
                  type="checkbox" 
                  [checked]="item.isSync" 
                  [disabled]="item.isSync || fieldIsTypeImage(item)"
                  class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                  [class.opacity-50]="!bothSchemasReady()"
                  (change)="markKeyword($event,item)"
                >
                
                <span class="flex items-center space-x-1">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-gray-500">
                    <path fill-rule="evenodd" d="M8 7a5 5 0 1 1 3.61 4.804l-1.903 1.903A1 1 0 0 1 9 14H8v1a1 1 0 0 1-1 1H6v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1v-2a1 1 0 0 1 .293-.707L8.196 8.39A5.002 5.002 0 0 1 8 7Zm5-3a.75.75 0 0 0 0 1.5A1.5 1.5 0 0 1 14.5 7 .75.75 0 0 0 16 7a3 3 0 0 0-3-3Z" clip-rule="evenodd" />
                  </svg>
                  <span class="font-medium">{{item.name}}</span>
                  @if(item.label && item.label !== item.name) {
                    <span class="text-sm text-gray-500">({{item.label}})</span>
                  }
                </span>

                <!-- Indicador de campo requerido -->
                @if(item.require && !item.isSync) {
                  <div class="tooltip inline-flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                        class="w-4 h-4 text-orange-500">
                      <path fill-rule="evenodd"
                          d="M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"
                          clip-rule="evenodd" />
                    </svg>
                    <span class="tooltiptext">Campo requerido en el documento fuente</span>
                  </div>
                }

                <!-- Indicador de sincronizaci贸n -->
                @if(item.isSync && bothSchemasReady()) {
                  <div class="tooltip inline-flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" 
                         class="w-4 h-4 text-green-600">
                      <path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" />
                    </svg>
                    <span class="tooltiptext">Sincronizado con el documento destino</span>
                  </div>
                }

                <!-- Indicador de no sincronizado cuando no hay documento destino -->
                @if(!bothSchemasReady()) {
                  <div class="tooltip inline-flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" 
                         class="w-4 h-4 text-gray-400">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                    </svg>
                    <span class="tooltiptext">
                      Documento de destino no existe
                      <!-- Requiere documento destino para comparar -->
                    </span>
                  </div>
                }
                @if(item.presentInTarget){
                  <div class="tooltip inline-flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"  class="w-4 h-4 text-blue-400">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                    </svg>
                    <span class="tooltiptext">Llave sincronizada</span>
                  </div>
                }
                @else {
                  <div class="tooltip inline-flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"  class="w-4 h-4 text-gray-400">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                    </svg>
                    <span class="tooltiptext">Llave no sincronizada</span>
                  </div>
                }
              </label>
            </li>
          }
        }
      }
    </ul>
  }
}

<!-- Modal de Error -->
<app-modal [isOpen]="errorModalOpen()" (close)="onModalHandlerClose()" [size]="'basic'">
  <div class="text-center">
    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
      <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
      </svg>
    </div>
    <h2 class="text-xl font-bold text-gray-900 mb-2">Error de Conexi贸n</h2>
    <p class="text-gray-600">
      No se pudieron recuperar los datos del sistema 
      <strong class="text-red-600">{{storeMessageFailured()}}</strong>
    </p>
    <p class="text-sm text-gray-500 mt-2">
      Por favor, verifique su conexi贸n e intente nuevamente.
    </p>
  </div>
</app-modal>